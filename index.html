
<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
* {
  box-sizing: border-box;
}

body {
  font: 16px Arial;
}

/*the container must be positioned relative:*/
.autocomplete {
  position: relative;
  display: inline-block;
}

button {
  text-align: center;
  text-decoration: none;
  display: inline;
  font-size: 16px;
}

input {
  border: 1px solid transparent;
  background-color: #f1f1f1;
  padding: 10px;
  font-size: 16px;
}

input[type=text] {
  background-color: #f1f1f1;
  width: 100%;
}

input[type=submit] {
  background-color: DodgerBlue;
  color: #fff;
  cursor: pointer;
}

.autocomplete-items {
  position: absolute;
  border: 1px solid #d4d4d4;
  border-bottom: none;
  border-top: none;
  z-index: 99;
  /*position the autocomplete items to be the same width as the container:*/
  top: 100%;
  left: 0;
  right: 0;
}

.autocomplete-items div {
  padding: 10px;
  cursor: pointer;
  background-color: #fff;
  border-bottom: 1px solid #d4d4d4;
}

/*when hovering an item:*/
.autocomplete-items div:hover {
  background-color: #e9e9e9;
}

/*when navigating through the items using the arrow keys:*/
.autocomplete-active {
  background-color: DodgerBlue !important;
  color: #ffffff;
}
.tooltip {
  position: relative;
  display: inline-block;
  border-bottom: 1px dotted black;
}

.tooltip .tooltiptext {
  visibility: hidden;
  width: 120px;
  background-color: black;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 5px 0;

  /* Position the tooltip */
  position: absolute;
  z-index: 1;
  bottom: 100%;
  left: 50%;
  margin-left: -60px;
}

.tooltip:hover .tooltiptext {
  visibility: visible;
}

</style>
    </head>
          <script>
              var request = new XMLHttpRequest();
              var obj = {};
              function load()
              {
                request.onreadystatechange = function() {
                  if (request.readyState == 4 && request.status == 200) {
                    obj = parseJSON(request.responseText);
                    fill(obj)
                  }
                };
                request.open("GET", "altereddata.json", true);
                request.send();
              }

              function parseJSON(text)
              {
                return JSON.parse(text);
              }
              function fill(mydata){
                 var units = [];
                 for (x in mydata){
                   units.push(x)
                 }
                 autocomplete(document.getElementById("myInput"), units);
               }
               function autocomplete(inp, arr) {
                 /*the autocomplete function takes two arguments,
                 the text field element and an array of possible autocompleted values:*/
                 var currentFocus;
                 /*execute a function when someone writes in the text field:*/
                 inp.addEventListener("input", function(e) {
                     var a, b, i, val = this.value;
                     /*close any already open lists of autocompleted values*/
                     closeAllLists();
                     if (!val) { return false;}
                     currentFocus = -1;
                     /*create a DIV element that will contain the items (values):*/
                     a = document.createElement("DIV");
                     a.setAttribute("id", this.id + "autocomplete-list");
                     a.setAttribute("class", "autocomplete-items");
                     /*append the DIV element as a child of the autocomplete container:*/
                     this.parentNode.appendChild(a);
                     /*for each item in the array...*/
                     for (i = 0; i < arr.length; i++) {
                       /*check if the item starts with the same letters as the text field value:*/
                       if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
                         /*create a DIV element for each matching element:*/
                         b = document.createElement("DIV");
                         /*make the matching letters bold:*/
                         b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
                         b.innerHTML += arr[i].substr(val.length);
                         /*insert a input field that will hold the current array item's value:*/
                         b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
                         /*execute a function when someone clicks on the item value (DIV element):*/
                         b.addEventListener("click", function(e) {
                             /*insert the value for the autocomplete text field:*/
                             inp.value = this.getElementsByTagName("input")[0].value;
                             /*close the list of autocompleted values,
                             (or any other open lists of autocompleted values:*/
                             closeAllLists();
                         });
                         a.appendChild(b);
                       }
                     }
                 });
                 /*execute a function presses a key on the keyboard:*/
                 inp.addEventListener("keydown", function(e) {
                     var x = document.getElementById(this.id + "autocomplete-list");
                     if (x) x = x.getElementsByTagName("div");
                     if (e.keyCode == 40) {
                       /*If the arrow DOWN key is pressed,
                       increase the currentFocus variable:*/
                       currentFocus++;
                       /*and and make the current item more visible:*/
                       addActive(x);
                     } else if (e.keyCode == 38) { //up
                       /*If the arrow UP key is pressed,
                       decrease the currentFocus variable:*/
                       currentFocus--;
                       /*and and make the current item more visible:*/
                       addActive(x);
                     } else if (e.keyCode == 13) {
                       /*If the ENTER key is pressed, prevent the form from being submitted,*/
                       e.preventDefault();
                       if (currentFocus > -1) {
                         /*and simulate a click on the "active" item:*/
                         if (x) x[currentFocus].click();
                       }
                     }
                 });
                 function addActive(x) {
                   /*a function to classify an item as "active":*/
                   if (!x) return false;
                   /*start by removing the "active" class on all items:*/
                   removeActive(x);
                   if (currentFocus >= x.length) currentFocus = 0;
                   if (currentFocus < 0) currentFocus = (x.length - 1);
                   /*add class "autocomplete-active":*/
                   x[currentFocus].classList.add("autocomplete-active");
                 }
                 function removeActive(x) {
                   /*a function to remove the "active" class from all autocomplete items:*/
                   for (var i = 0; i < x.length; i++) {
                     x[i].classList.remove("autocomplete-active");
                   }
                 }
                 function closeAllLists(elmnt) {
                   /*close all autocomplete lists in the document,
                   except the one passed as an argument:*/
                   var x = document.getElementsByClassName("autocomplete-items");
                   for (var i = 0; i < x.length; i++) {
                     if (elmnt != x[i] && elmnt != inp) {
                       x[i].parentNode.removeChild(x[i]);
                     }
                   }
                 }
                 /*execute a function when someone clicks in the document:*/
                 document.addEventListener("click", function (e) {
                     closeAllLists(e.target);
                 });
                 document.getElementById("add").onclick = function() {
                    //First things first, we need our text:
                    var text = document.getElementById("myInput").value; //.value gets input values
                    var ul = document.getElementById("unitlist");
                    var items = ul.getElementsByTagName("li");
                    var flag = false
                    for (var i = 0; i < items.length; ++i) {
                      if (items[i].getElementsByTagName("span")[0].firstChild.nodeValue==text){
                        flag=true
                      }
                    }
                    if (!flag){
                      var para = document.createElement("span");
                      var node = document.createElement("LI");                 // Create a <li> node
                      var textnode = document.createTextNode(text);         // Create a text node
                      para.appendChild(textnode);
                      var button = document.createElement("button");
                      button.innerHTML = "-";
                      button.addEventListener ("click", function() {
                        var unitr = button.parentElement.childNodes[0].nodeValue
                        var listelement= button.parentElement.parentElement
                        listelement.parentElement.removeChild(listelement)
                        document.getElementById("credittotal").innerHTML = - parseInt(obj[unitr].credits) + parseInt(document.getElementById("credittotal").innerHTML)
                        if (parseInt(obj[unitr].tb)==1){
                          document.getElementById("tb1credits").innerHTML = - parseInt(obj[unitr].credits) + parseInt(document.getElementById("tb1credits").innerHTML)
                        }
                        else if (parseInt(obj[unitr].tb)==2){
                          document.getElementById("tb2credits").innerHTML = - parseInt(obj[unitr].credits) + parseInt(document.getElementById("tb2credits").innerHTML)
                        }
                        else if (parseInt(obj[unitr].tb)==4){
                          document.getElementById("tb1credits").innerHTML = - parseInt(obj[unitr].credits)/2 + parseInt(document.getElementById("tb1credits").innerHTML)
                          document.getElementById("tb2credits").innerHTML = - parseInt(obj[unitr].credits)/2 + parseInt(document.getElementById("tb2credits").innerHTML)
                        }
                      });
                      para.appendChild(button);
                      node.appendChild(para);
                      document.getElementById("unitlist").appendChild(node);
                      request.onreadystatechange = function() {
                        if (request.readyState == 4 && request.status == 200) {
                          document.getElementById("credittotal").innerHTML = parseInt(obj[text].credits) + parseInt(document.getElementById("credittotal").innerHTML)
                          if (parseInt(obj[text].tb)==1){
                            document.getElementById("tb1credits").innerHTML = + parseInt(obj[text].credits) + parseInt(document.getElementById("tb1credits").innerHTML)
                          }
                          else if (parseInt(obj[text].tb)==2){
                            document.getElementById("tb2credits").innerHTML = + parseInt(obj[text].credits) + parseInt(document.getElementById("tb2credits").innerHTML)
                          }
                          else if (parseInt(obj[text].tb)==4){
                            document.getElementById("tb1credits").innerHTML = + parseInt(obj[text].credits)/2 + parseInt(document.getElementById("tb1credits").innerHTML)
                            document.getElementById("tb2credits").innerHTML = + parseInt(obj[text].credits)/2 + parseInt(document.getElementById("tb2credits").innerHTML)
                          }
                        }
                      }
                      request.open("GET", "data.json", true);
                      request.send();
                      document.getElementById('myInput').value = ''
                      }
                      else {
                        alert("Unit " + text + " has already been selected.")
                        document.getElementById('myInput').value = ''
                      }
                    }
                  document.getElementById("generate").onclick = function() {
                      var table = document.createElement("table");
                      var head = document.createElement("thead");
                      var body = document.createElement("tbody");
                      var rowh2 = document.createElement("tr");
                      var heading = document.createElement("th");
                      days=["","Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"]
                      for (j=0;j<8;j++){
                        var heading = document.createElement("th");
                        heading.innerHTML=days[j]
                        rowh2.appendChild(heading)
                      }
                      head.appendChild(rowh2)
                      for (i=0; i<36; i++){
                      var row = document.createElement("tr");
                      var heading = document.createElement("th");
                      if (i+1<13){
                        heading.innerHTML="Week " + (i+1)
                      }
                      if (i+1>12 && i+1<16){
                        heading.innerHTML="Winter Vacation"
                      }
                      if (i+1>15 && i+1<18){
                        heading.innerHTML="Winter exams"
                      }
                      if (i+1>17){
                        heading.innerHTML="Week " + (i-4)
                      }
                      if (i+1>26 && i+1<30){
                        heading.innerHTML="Spring Break"
                      }
                      if (i+1>29 && i+1<33){
                        heading.innerHTML="Week " + (i-7)
                      }
                      if (i+1==33){
                        heading.innerHTML="Revision Week"
                      }
                      if (i+1>33){
                        heading.innerHTML="Summer Exams"
                      }
                      row.appendChild(heading)
                      for (k=0;k<7;k++){
                        var data = document.createElement("td");
                        row.appendChild(data)
                      }
                      body.appendChild(row)
                    }
                    table.appendChild(head)
                    table.appendChild(body)
                    document.getElementById("table").appendChild(table)
                    var ul = document.getElementById("unitlist");
                    var items=ul.getElementsByTagName("li");
                    var units=[]
                    for (i=0; i<items.length; i++) {
                      units.push(items[i].getElementsByTagName("span")[0].firstChild.nodeValue)
                    }
                    for (unit of units){
                      for (assessment of obj[unit]["assessments"]){
                        var x = 0
                        if (assessment["deadline"][1]>40){
                          x=assessment["deadline"][1]-40
                        }
                        else x=assessment["deadline"][1]+13
                        d=assessment["deadline"][0]
                        var span =document.createElement("span");
                        span.setAttribute('class', 'tooltip')
                        span.textContent="!"
                        var tspan =document.createElement("span");
                        tspan.setAttribute('class', 'tooltiptext')
                        var credits=obj[unit].credits
                        var weight=parseInt(assessment["weight"])/100
                        var string = " credits. \n"
                        if ((credits*weight)<=1){
                          string=" credit. \n"
                        }
                        tspan.textContent="Deadline for " + unit + ", worth " + credits*weight + string
                        span.appendChild(tspan)
                        document.querySelector(`#table > table tr:nth-of-type(${x+1}) td:nth-of-type(${d+1})`).appendChild(span)
                    }
                  }
                  var worktable = []
                  for (var j=0;j<36;j++){
                    worktable.push([0,0,0,0,0,0,0])
                  }
                  for (var i=0;i<36;i++){
                    if ((i>14 && i<17) || (i>32 && i<36)){
                      for (var j=0;j<7;j++){
                        worktable[i][j]='X'
                      }
                    }
                  }
                  if (!document.getElementById("weekends").checked){
                    for (var i=0;i<36;i++){
                      worktable[i][5]='X'
                      worktable[i][6]='X'
                    }
                  }
                  if (!document.getElementById("vacation").checked){
                    for (var i=0;i<36;i++){
                      if ((i>12 && i<16) || i+1>26 && i+1<30){
                        for (var j=0;j<7;j++){
                          worktable[i][j]='X'
                        }
                      }
                    }
                  }
                  var week = 0
                  var day = 0
                  var pweek = 0
                  var pday = 0
                  var peweek = 0
                  var peday = 0
                  var credits =0
                  var weight=0
                  var assvaliddays=0
                  var number=0
                  for (unit of units){
                    if(obj[unit].tb=="2"){
                      pweek=17
                      peweek=17
                    }
                    else {
                      pweek=0
                      peweek=0
                    }
                    for (assessment of obj[unit]["assessments"]){
                      assvaliddays=0
                      if (assessment["deadline"][1]>40){
                        week=assessment["deadline"][1]-40
                      }
                      else week=assessment["deadline"][1]+13
                      day=assessment["deadline"][0]
                      credits=obj[unit].credits
                      weight=parseInt(assessment["weight"])/100
                      if (assessment.type=="nonexam"){
                        for (var i=pweek; i<week+1; i++){
                          if (i==pweek){
                            for (var j=pday; j<7;j++){
                              if (worktable[i][j]!='X'){
                                assvaliddays++
                              }
                            }
                          }
                          else if (i==week){
                            for (var j=0; j<day;j++){
                              if (worktable[i][j]!='X'){
                                assvaliddays++
                              }
                            }
                          }
                          else {
                            for (var j=0; j<7;j++){
                              if (worktable[i][j]!='X'){
                                assvaliddays++
                              }
                            }
                          }
                        }
                        number=credits*weight/assvaliddays
                        for (var i=pweek; i<week+1; i++){
                          if (i==pweek){
                            for (var j=pday; j<7;j++){
                              if (worktable[i][j]!='X'){
                                worktable[i][j]+=number
                              }
                            }
                          }
                          else if (i==week){
                            for (var j=0; j<day;j++){
                              if (worktable[i][j]!='X'){
                                worktable[i][j]+=number
                              }
                            }
                          }
                          else {
                            for (var j=0; j<7;j++){
                              if (worktable[i][j]!='X'){
                                worktable[i][j]+=number
                              }
                            }
                          }
                        }
                        pweek=week
                        pday=day
                      }
                      else if (assessment.type=="exam"){
                        for (var i=peweek; i<week+1; i++){
                            for (var j=0; j<7;j++){
                              if (worktable[i][j]!='X'){
                                assvaliddays++
                              }
                            }
                          }
                          number=credits*weight/assvaliddays
                          for (var i=peweek; i<week+1; i++){
                            for (var j=0; j<7;j++){
                              if (worktable[i][j]!='X'){
                                worktable[i][j]+=number
                              }
                            }
                          }
                          peweek=week
                          peday=day
                      }
                  }
               }
               validdaystb1=0
               for (var i=0;i<16;i++){
                 for (var j=0; j<7; j++){
                   if (worktable[i][j]!='X'){
                     validdaystb1++
                   }
                 }
               }
               validdaystb2=0
               for (var i=17;i<33;i++){
                 for (var j=0; j<7; j++){
                   if (worktable[i][j]!='X'){
                     validdaystb2++
                   }
                 }
               }
               for (var i=0;i<16;i++){
                 for (var j=0; j<7; j++){
                   if (worktable[i][j]!='X'){
                     worktable[i][j]/=parseInt(document.getElementById("tb1").options[document.getElementById("tb1").selectedIndex].text)/validdaystb1
                   }
                 }
               }
               for (var i=16;i<33;i++){
                 for (var j=0; j<7; j++){
                   if (worktable[i][j]!='X'){
                     worktable[i][j]/=parseInt(document.getElementById("tb2").options[document.getElementById("tb2").selectedIndex].text)/validdaystb2
                   }
                 }
               }
               alert(worktable)
               table=document.getElementById("table").children[0].children[1]
               for (var i=0; i<33; i++){
                 for (var j=0; j<33; j++){
                   if (worktable[i][j]<0.95){
                     table.children[i].children[j+1].style.backgroundColor = '#75C124'
                   }
                   else if (worktable[i][j]>=0.95 && worktable[i][j]<=1.05){
                     table.children[i].children[j+1].style.backgroundColor = '#E7FF33'
                   }
                   else if (worktable[i][j]>1.05){
                     table.children[i].children[j+1].style.backgroundColor = '#FF9B31'
                   }
                 }
               }
             }
           }
     </script>
<body onload="load()">
<p>
Include weekends?
<input type="checkbox" id="weekends">
</p>
<p>
Include vacation?
<input type="checkbox" id="vacation">
</p>
<p>
Number of credits selected:
<span id="credittotal">0</span>
(TB1:
 <span id="tb1credits">0</span>
 , TB2:
 <span id="tb2credits">0</span>
)
</p>
<span>
        Compare with a
         <select id = "tb1">
            <option value = "10">10</option>
            <option value = "20">20</option>
            <option value = "30">30</option>
            <option value = "40">40</option>
            <option value = "50">50</option>
            <option value = "60" selected>60</option>
            <option value = "70">70</option>
            <option value = "80">80</option>
            <option value = "90">90</option>
            <option value = "100">100</option>
            <option value = "110">110</option>
            <option value = "120">120</option>
         </select>
              -
               <select id = "tb2">
                  <option value = "10">10</option>
                  <option value = "20">20</option>
                  <option value = "30">30</option>
                  <option value = "40">40</option>
                  <option value = "50">50</option>
                  <option value = "60" selected>60</option>
                  <option value = "70">70</option>
                  <option value = "80">80</option>
                  <option value = "90">90</option>
                  <option value = "100">100</option>
                  <option value = "110">110</option>
                  <option value = "120">120</option>
               </select>
               split.
    </span>
<p>Select units:</p>

<!--Make sure the form has the autocomplete function switched off:-->
<form autocomplete="off" action="/action_page.php">
  <div class="autocomplete" style="width:300px;">
    <input id="myInput" type="text" name="myUnit" placeholder="Unit">
  </div>
  <input type='button' value='add to list' id='add' />
</form>
<ul id='unitlist'></ul>
<input type='button' value='generate table' id='generate' />
<para id="table"> </para>
</body>
</html>
